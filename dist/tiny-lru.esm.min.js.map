{"version":3,"file":"tiny-lru.esm.min.js","sources":["../src/lru.js"],"sourcesContent":["class LRU {\n\tconstructor (max = 0, ttl = 0) {\n\t\tthis.first = null;\n\t\tthis.items = Object.create(null);\n\t\tthis.last = null;\n\t\tthis.max = max;\n\t\tthis.size = 0;\n\t\tthis.ttl = ttl;\n\t}\n\n\t#has (key) {\n\t\treturn key in this.items;\n\t}\n\n\tclear () {\n\t\tthis.first = null;\n\t\tthis.items = Object.create(null);\n\t\tthis.last = null;\n\t\tthis.size = 0;\n\n\t\treturn this;\n\t}\n\n\tdelete (key) {\n\t\tif (this.#has(key)) {\n\t\t\tconst item = this.items[key];\n\n\t\t\tdelete this.items[key];\n\t\t\tthis.size--;\n\n\t\t\tif (item.prev !== null) {\n\t\t\t\titem.prev.next = item.next;\n\t\t\t}\n\n\t\t\tif (item.next !== null) {\n\t\t\t\titem.next.prev = item.prev;\n\t\t\t}\n\n\t\t\tif (this.first === item) {\n\t\t\t\tthis.first = item.next;\n\t\t\t}\n\n\t\t\tif (this.last === item) {\n\t\t\t\tthis.last = item.prev;\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tevict (bypass = false) {\n\t\tif (bypass || this.size > 0) {\n\t\t\tconst item = this.first;\n\n\t\t\tdelete this.items[item.key];\n\t\t\tthis.size--;\n\n\t\t\tif (this.size === 0) {\n\t\t\t\tthis.first = null;\n\t\t\t\tthis.last = null;\n\t\t\t} else {\n\t\t\t\tthis.first = item.next;\n\t\t\t\tthis.first.prev = null;\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tget (key) {\n\t\tlet result;\n\n\t\tif (this.#has(key)) {\n\t\t\tconst item = this.items[key];\n\n\t\t\tif (this.ttl > 0 && item.expiry <= new Date().getTime()) {\n\t\t\t\tthis.delete(key);\n\t\t\t} else {\n\t\t\t\tresult = item.value;\n\t\t\t\tthis.set(key, result, true);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tkeys () {\n\t\treturn Object.keys(this.items);\n\t}\n\n\tset (key, value, bypass = false, resetTtl = false) {\n\t\tlet item;\n\n\t\tif (bypass || this.#has(key)) {\n\t\t\titem = this.items[key];\n\t\t\titem.value = value;\n\n\t\t\tif (this.last !== item) {\n\t\t\t\tconst last = this.last,\n\t\t\t\t\tnext = item.next,\n\t\t\t\t\tprev = item.prev;\n\n\t\t\t\tif (this.first === item) {\n\t\t\t\t\tthis.first = item.next;\n\t\t\t\t}\n\n\t\t\t\tif (resetTtl) {\n\t\t\t\t\titem.expiry = this.ttl > 0 ? new Date().getTime() + this.ttl : this.ttl;\n\t\t\t\t}\n\n\t\t\t\titem.next = null;\n\t\t\t\titem.prev = this.last;\n\t\t\t\tlast.next = item;\n\n\t\t\t\tif (prev !== null) {\n\t\t\t\t\tprev.next = next;\n\t\t\t\t}\n\n\t\t\t\tif (next !== null) {\n\t\t\t\t\tnext.prev = prev;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (this.max > 0 && this.size === this.max) {\n\t\t\t\tthis.evict(true);\n\t\t\t}\n\n\t\t\titem = this.items[key] = {\n\t\t\t\texpiry: this.ttl > 0 ? new Date().getTime() + this.ttl : this.ttl,\n\t\t\t\tkey: key,\n\t\t\t\tprev: this.last,\n\t\t\t\tnext: null,\n\t\t\t\tvalue\n\t\t\t};\n\n\t\t\tif (++this.size === 1) {\n\t\t\t\tthis.first = item;\n\t\t\t} else {\n\t\t\t\tthis.last.next = item;\n\t\t\t}\n\t\t}\n\n\t\tthis.last = item;\n\n\t\treturn this;\n\t}\n}\n\nexport function lru (max = 1000, ttl = 0) {\n\tif (isNaN(max) || max < 0) {\n\t\tthrow new TypeError(\"Invalid max value\");\n\t}\n\n\tif (isNaN(ttl) || ttl < 0) {\n\t\tthrow new TypeError(\"Invalid ttl value\");\n\t}\n\n\treturn new LRU(max, ttl);\n}\n"],"names":["LRU","constructor","max","ttl","this","first","items","Object","create","last","size","has","key","clear","delete","item","prev","next","evict","bypass","get","result","expiry","Date","getTime","value","set","keys","resetTtl","lru","isNaN","TypeError"],"mappings":"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"}