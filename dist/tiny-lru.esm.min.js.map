{"version":3,"file":"tiny-lru.esm.min.js","sources":["../src/lru.js"],"sourcesContent":["class LRU {\r\n\tconstructor (max = 0, ttl = 0, resetTtl = false) {\r\n\t\tthis.first = null;\r\n\t\tthis.items = new Map();\r\n\t\tthis.last = null;\r\n\t\tthis.max = max;\r\n\t\tthis.resetTtl = resetTtl;\r\n\t\tthis.ttl = ttl;\r\n\t}\r\n\r\n\tclear () {\r\n\t\tthis.first = null;\r\n\t\tthis.items = new Map();\r\n\t\tthis.last = null;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tdelete (key) {\r\n\t\tif (this.items.has(key)) {\r\n\t\t\tconst item = this.items.get(key);\r\n\r\n\t\t\tthis.items.delete(key);\r\n\r\n\t\t\tif (item.prev !== null) {\r\n\t\t\t\titem.prev.next = item.next;\r\n\t\t\t}\r\n\r\n\t\t\tif (item.next !== null) {\r\n\t\t\t\titem.next.prev = item.prev;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.first === item) {\r\n\t\t\t\tthis.first = item.next;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.last === item) {\r\n\t\t\t\tthis.last = item.prev;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tevict (bypass = false) {\r\n\t\tif (bypass || this.size > 0) {\r\n\t\t\tconst item = this.first;\r\n\r\n\t\t\tthis.items.delete(item.key);\r\n\r\n\t\t\tif (this.size === 0) {\r\n\t\t\t\tthis.first = null;\r\n\t\t\t\tthis.last = null;\r\n\t\t\t} else {\r\n\t\t\t\tthis.first = item.next;\r\n\t\t\t\tthis.first.prev = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tget (key) {\r\n\t\tlet result;\r\n\r\n\t\tif (this.items.has(key)) {\r\n\t\t\tconst item = this.items.get(key);\r\n\r\n\t\t\tif (this.ttl > 0 && item.expiry <= Date.now()) {\r\n\t\t\t\tthis.delete(key);\r\n\t\t\t} else {\r\n\t\t\t\tresult = item.value;\r\n\t\t\t\tthis.set(key, result, true);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\texpiresAt (key) {\r\n\t\tlet result;\r\n\r\n\t\tif (this.items.has(key)) {\r\n\t\t\tresult = this.items.get(key).expiry;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tkeys () {\r\n\t\treturn this.items.keys();\r\n\t}\r\n\r\n\tset (key, value, bypass = false, resetTtl = this.resetTtl) {\r\n\t\tlet item;\r\n\r\n\t\tif (bypass || this.items.has(key)) {\r\n\t\t\titem = this.items.get(key);\r\n\t\t\titem.value = value;\r\n\r\n\t\t\tif (resetTtl) {\r\n\t\t\t\titem.expiry = this.ttl > 0 ? Date.now() + this.ttl : this.ttl;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.last !== item) {\r\n\t\t\t\tconst last = this.last,\r\n\t\t\t\t\tnext = item.next,\r\n\t\t\t\t\tprev = item.prev;\r\n\r\n\t\t\t\tif (this.first === item) {\r\n\t\t\t\t\tthis.first = item.next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\titem.next = null;\r\n\t\t\t\titem.prev = this.last;\r\n\t\t\t\tlast.next = item;\r\n\r\n\t\t\t\tif (prev !== null) {\r\n\t\t\t\t\tprev.next = next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (next !== null) {\r\n\t\t\t\t\tnext.prev = prev;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (this.max > 0 && this.size === this.max) {\r\n\t\t\t\tthis.evict(true);\r\n\t\t\t}\r\n\r\n\t\t\titem = {\r\n\t\t\t\texpiry: this.ttl > 0 ? Date.now() + this.ttl : this.ttl,\r\n\t\t\t\tkey: key,\r\n\t\t\t\tprev: this.last,\r\n\t\t\t\tnext: null,\r\n\t\t\t\tvalue\r\n\t\t\t};\r\n\t\t\tthis.items.set(key, item);\r\n\r\n\t\t\tif (this.size === 1) {\r\n\t\t\t\tthis.first = item;\r\n\t\t\t} else {\r\n\t\t\t\tthis.last.next = item;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.last = item;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tget size () {\r\n\t\treturn this.items.size;\r\n\t}\r\n}\r\n\r\nexport function lru (max = 1000, ttl = 0, resetTtl = false) {\r\n\tif (isNaN(max) || max < 0) {\r\n\t\tthrow new TypeError(\"Invalid max value\");\r\n\t}\r\n\r\n\tif (isNaN(ttl) || ttl < 0) {\r\n\t\tthrow new TypeError(\"Invalid ttl value\");\r\n\t}\r\n\r\n\tif (typeof resetTtl !== \"boolean\") {\r\n\t\tthrow new TypeError(\"Invalid resetTtl value\");\r\n\t}\r\n\r\n\treturn new LRU(max, ttl, resetTtl);\r\n}\r\n"],"names":["LRU","constructor","max","ttl","resetTtl","this","first","items","Map","last","clear","delete","key","has","item","get","prev","next","evict","bypass","size","result","expiry","Date","now","value","set","expiresAt","keys","lru","isNaN","TypeError"],"mappings":"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"}