{"version":3,"file":"tiny-lru.umd.min.js","sources":["../src/has.js","../src/lru.js"],"sourcesContent":["export function has (items, key) {\r\n\treturn key in items;\r\n}\n","import {has} from \"./has.js\";\r\n\r\nclass LRU {\r\n\tconstructor (max = 0, ttl = 0, resetTtl = false) {\r\n\t\tthis.first = null;\r\n\t\tthis.items = Object.create(null);\r\n\t\tthis.last = null;\r\n\t\tthis.max = max;\r\n\t\tthis.resetTtl = resetTtl;\r\n\t\tthis.size = 0;\r\n\t\tthis.ttl = ttl;\r\n\t}\r\n\r\n\tclear () {\r\n\t\tthis.first = null;\r\n\t\tthis.items = Object.create(null);\r\n\t\tthis.last = null;\r\n\t\tthis.size = 0;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tdelete (key) {\r\n\t\tif (has(this.items, key)) {\r\n\t\t\tconst item = this.items[key];\r\n\r\n\t\t\tdelete this.items[key];\r\n\t\t\tthis.size--;\r\n\r\n\t\t\tif (item.prev !== null) {\r\n\t\t\t\titem.prev.next = item.next;\r\n\t\t\t}\r\n\r\n\t\t\tif (item.next !== null) {\r\n\t\t\t\titem.next.prev = item.prev;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.first === item) {\r\n\t\t\t\tthis.first = item.next;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.last === item) {\r\n\t\t\t\tthis.last = item.prev;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tevict (bypass = false) {\r\n\t\tif (bypass || this.size > 0) {\r\n\t\t\tconst item = this.first;\r\n\r\n\t\t\tdelete this.items[item.key];\r\n\r\n\t\t\tif (--this.size === 0) {\r\n\t\t\t\tthis.first = null;\r\n\t\t\t\tthis.last = null;\r\n\t\t\t} else {\r\n\t\t\t\tthis.first = item.next;\r\n\t\t\t\tthis.first.prev = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\texpiresAt (key) {\r\n\t\tlet result;\r\n\r\n\t\tif (has(this.items, key)) {\r\n\t\t\tresult = this.items[key].expiry;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tget (key) {\r\n\t\tlet result;\r\n\r\n\t\tif (has(this.items, key)) {\r\n\t\t\tconst item = this.items[key];\r\n\r\n\t\t\tif (this.ttl > 0 && item.expiry <= Date.now()) {\r\n\t\t\t\tthis.delete(key);\r\n\t\t\t} else {\r\n\t\t\t\tresult = item.value;\r\n\t\t\t\tthis.set(key, result, true);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tkeys () {\r\n\t\treturn Object.keys(this.items);\r\n\t}\r\n\r\n\tset (key, value, bypass = false, resetTtl = this.resetTtl) {\r\n\t\tlet item;\r\n\r\n\t\tif (bypass || has(this.items, key)) {\r\n\t\t\titem = this.items[key];\r\n\t\t\titem.value = value;\r\n\r\n\t\t\tif (resetTtl) {\r\n\t\t\t\titem.expiry = this.ttl > 0 ? Date.now() + this.ttl : this.ttl;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.last !== item) {\r\n\t\t\t\tconst last = this.last,\r\n\t\t\t\t\tnext = item.next,\r\n\t\t\t\t\tprev = item.prev;\r\n\r\n\t\t\t\tif (this.first === item) {\r\n\t\t\t\t\tthis.first = item.next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\titem.next = null;\r\n\t\t\t\titem.prev = this.last;\r\n\t\t\t\tlast.next = item;\r\n\r\n\t\t\t\tif (prev !== null) {\r\n\t\t\t\t\tprev.next = next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (next !== null) {\r\n\t\t\t\t\tnext.prev = prev;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (this.max > 0 && this.size === this.max) {\r\n\t\t\t\tthis.evict(true);\r\n\t\t\t}\r\n\r\n\t\t\titem = this.items[key] = {\r\n\t\t\t\texpiry: this.ttl > 0 ? Date.now() + this.ttl : this.ttl,\r\n\t\t\t\tkey: key,\r\n\t\t\t\tprev: this.last,\r\n\t\t\t\tnext: null,\r\n\t\t\t\tvalue\r\n\t\t\t};\r\n\r\n\t\t\tif (++this.size === 1) {\r\n\t\t\t\tthis.first = item;\r\n\t\t\t} else {\r\n\t\t\t\tthis.last.next = item;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.last = item;\r\n\r\n\t\treturn this;\r\n\t}\r\n}\r\n\r\nexport function lru (max = 1000, ttl = 0, resetTtl = false) {\r\n\tif (isNaN(max) || max < 0) {\r\n\t\tthrow new TypeError(\"Invalid max value\");\r\n\t}\r\n\r\n\tif (isNaN(ttl) || ttl < 0) {\r\n\t\tthrow new TypeError(\"Invalid ttl value\");\r\n\t}\r\n\r\n\tif (typeof resetTtl !== \"boolean\") {\r\n\t\tthrow new TypeError(\"Invalid resetTtl value\");\r\n\t}\r\n\r\n\treturn new LRU(max, ttl, resetTtl);\r\n}\r\n"],"names":["g","f","exports","module","define","amd","globalThis","self","lru","this","has","items","key","LRU","constructor","max","ttl","resetTtl","first","Object","create","last","size","clear","delete","item","prev","next","evict","bypass","expiresAt","result","expiry","get","Date","now","value","set","keys","isNaN","TypeError"],"mappings":"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"}