{"version":3,"file":"tiny-lru.umd.min.js","sources":["../src/lru.js"],"sourcesContent":["export class LRU {\n\tconstructor (max = 0, ttl = 0, resetTtl = false) {\n\t\tthis.first = null;\n\t\tthis.items = Object.create(null);\n\t\tthis.last = null;\n\t\tthis.max = max;\n\t\tthis.resetTtl = resetTtl;\n\t\tthis.size = 0;\n\t\tthis.ttl = ttl;\n\t}\n\n\tclear () {\n\t\tthis.first = null;\n\t\tthis.items = Object.create(null);\n\t\tthis.last = null;\n\t\tthis.size = 0;\n\n\t\treturn this;\n\t}\n\n\tdelete (key) {\n\t\tif (this.has(key)) {\n\t\t\tconst item = this.items[key];\n\n\t\t\tdelete this.items[key];\n\t\t\tthis.size--;\n\n\t\t\tif (item.prev !== null) {\n\t\t\t\titem.prev.next = item.next;\n\t\t\t}\n\n\t\t\tif (item.next !== null) {\n\t\t\t\titem.next.prev = item.prev;\n\t\t\t}\n\n\t\t\tif (this.first === item) {\n\t\t\t\tthis.first = item.next;\n\t\t\t}\n\n\t\t\tif (this.last === item) {\n\t\t\t\tthis.last = item.prev;\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tentries (keys = this.keys()) {\n\t\treturn keys.map(key => [key, this.get(key)]);\n\t}\n\n\tevict (bypass = false) {\n\t\tif (bypass || this.size > 0) {\n\t\t\tconst item = this.first;\n\n\t\t\tdelete this.items[item.key];\n\n\t\t\tif (--this.size === 0) {\n\t\t\t\tthis.first = null;\n\t\t\t\tthis.last = null;\n\t\t\t} else {\n\t\t\t\tthis.first = item.next;\n\t\t\t\tthis.first.prev = null;\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\texpiresAt (key) {\n\t\tlet result;\n\n\t\tif (this.has(key)) {\n\t\t\tresult = this.items[key].expiry;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tget (key) {\n\t\tlet result;\n\n\t\tif (this.has(key)) {\n\t\t\tconst item = this.items[key];\n\n\t\t\tif (this.ttl > 0 && item.expiry <= Date.now()) {\n\t\t\t\tthis.delete(key);\n\t\t\t} else {\n\t\t\t\tresult = item.value;\n\t\t\t\tthis.set(key, result, true);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\thas (key) {\n\t\treturn key in this.items;\n\t}\n\n\tkeys () {\n\t\tconst result = [];\n\t\tlet x = this.first;\n\n\t\twhile (x !== null) {\n\t\t\tresult.push(x.key);\n\t\t\tx = x.next;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tsetWithEvicted (key, value, resetTtl = this.resetTtl) {\n\t\tlet evicted = null;\n\n\t\tif (this.has(key)) {\n\t\t\tthis.set(key, value, true, resetTtl);\n\t\t} else {\n\t\t\tif (this.max > 0 && this.size === this.max) {\n\t\t\t\tevicted = {...this.first};\n\t\t\t\tthis.evict(true);\n\t\t\t}\n\n\t\t\tlet item = this.items[key] = {\n\t\t\t\texpiry: this.ttl > 0 ? Date.now() + this.ttl : this.ttl,\n\t\t\t\tkey: key,\n\t\t\t\tprev: this.last,\n\t\t\t\tnext: null,\n\t\t\t\tvalue\n\t\t\t};\n\n\t\t\tif (++this.size === 1) {\n\t\t\t\tthis.first = item;\n\t\t\t} else {\n\t\t\t\tthis.last.next = item;\n\t\t\t}\n\n\t\t\tthis.last = item;\n\t\t}\n\n\t\treturn evicted;\n\t}\n\n\tset (key, value, bypass = false, resetTtl = this.resetTtl) {\n\t\tlet item;\n\n\t\tif (bypass || this.has(key)) {\n\t\t\titem = this.items[key];\n\t\t\titem.value = value;\n\n\t\t\tif (bypass === false && resetTtl) {\n\t\t\t\titem.expiry = this.ttl > 0 ? Date.now() + this.ttl : this.ttl;\n\t\t\t}\n\n\t\t\tif (this.last !== item) {\n\t\t\t\tconst last = this.last,\n\t\t\t\t\tnext = item.next,\n\t\t\t\t\tprev = item.prev;\n\n\t\t\t\tif (this.first === item) {\n\t\t\t\t\tthis.first = item.next;\n\t\t\t\t}\n\n\t\t\t\titem.next = null;\n\t\t\t\titem.prev = this.last;\n\t\t\t\tlast.next = item;\n\n\t\t\t\tif (prev !== null) {\n\t\t\t\t\tprev.next = next;\n\t\t\t\t}\n\n\t\t\t\tif (next !== null) {\n\t\t\t\t\tnext.prev = prev;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (this.max > 0 && this.size === this.max) {\n\t\t\t\tthis.evict(true);\n\t\t\t}\n\n\t\t\titem = this.items[key] = {\n\t\t\t\texpiry: this.ttl > 0 ? Date.now() + this.ttl : this.ttl,\n\t\t\t\tkey: key,\n\t\t\t\tprev: this.last,\n\t\t\t\tnext: null,\n\t\t\t\tvalue\n\t\t\t};\n\n\t\t\tif (++this.size === 1) {\n\t\t\t\tthis.first = item;\n\t\t\t} else {\n\t\t\t\tthis.last.next = item;\n\t\t\t}\n\t\t}\n\n\t\tthis.last = item;\n\n\t\treturn this;\n\t}\n\n\tvalues (keys = this.keys()) {\n\t\treturn keys.map(key => this.get(key));\n\t}\n}\n\nexport function lru (max = 1000, ttl = 0, resetTtl = false) {\n\tif (isNaN(max) || max < 0) {\n\t\tthrow new TypeError(\"Invalid max value\");\n\t}\n\n\tif (isNaN(ttl) || ttl < 0) {\n\t\tthrow new TypeError(\"Invalid ttl value\");\n\t}\n\n\tif (typeof resetTtl !== \"boolean\") {\n\t\tthrow new TypeError(\"Invalid resetTtl value\");\n\t}\n\n\treturn new LRU(max, ttl, resetTtl);\n}\n"],"names":["g","f","exports","module","define","amd","globalThis","self","lru","this","LRU","constructor","max","ttl","resetTtl","first","items","Object","create","last","size","clear","key","has","item","prev","next","entries","keys","map","get","evict","bypass","expiresAt","result","expiry","Date","now","delete","value","set","x","push","setWithEvicted","evicted","values","isNaN","TypeError"],"mappings":"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"}