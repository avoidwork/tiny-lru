{"version":3,"file":"tiny-lru.min.js","sources":["../src/lru.js"],"sourcesContent":["class LRU {\r\n\tconstructor (max = 0, ttl = 0) {\r\n\t\tthis.first = null;\r\n\t\tthis.items = Object.create(null);\r\n\t\tthis.last = null;\r\n\t\tthis.max = max;\r\n\t\tthis.size = 0;\r\n\t\tthis.ttl = ttl;\r\n\t}\r\n\r\n\t#has (key) {\r\n\t\treturn key in this.items;\r\n\t}\r\n\r\n\tclear () {\r\n\t\tthis.first = null;\r\n\t\tthis.items = Object.create(null);\r\n\t\tthis.last = null;\r\n\t\tthis.size = 0;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tdelete (key) {\r\n\t\tif (this.#has(key)) {\r\n\t\t\tconst item = this.items[key];\r\n\r\n\t\t\tdelete this.items[key];\r\n\t\t\tthis.size--;\r\n\r\n\t\t\tif (item.prev !== null) {\r\n\t\t\t\titem.prev.next = item.next;\r\n\t\t\t}\r\n\r\n\t\t\tif (item.next !== null) {\r\n\t\t\t\titem.next.prev = item.prev;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.first === item) {\r\n\t\t\t\tthis.first = item.next;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.last === item) {\r\n\t\t\t\tthis.last = item.prev;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tevict (bypass = false) {\r\n\t\tif (bypass || this.size > 0) {\r\n\t\t\tconst item = this.first;\r\n\r\n\t\t\tdelete this.items[item.key];\r\n\t\t\tthis.size--;\r\n\r\n\t\t\tif (this.size === 0) {\r\n\t\t\t\tthis.first = null;\r\n\t\t\t\tthis.last = null;\r\n\t\t\t} else {\r\n\t\t\t\tthis.first = item.next;\r\n\t\t\t\tthis.first.prev = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tget (key) {\r\n\t\tlet result;\r\n\r\n\t\tif (this.#has(key)) {\r\n\t\t\tconst item = this.items[key];\r\n\r\n\t\t\tif (this.ttl > 0 && item.expiry <= new Date().getTime()) {\r\n\t\t\t\tthis.delete(key);\r\n\t\t\t} else {\r\n\t\t\t\tresult = item.value;\r\n\t\t\t\tthis.set(key, result, true);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tkeys () {\r\n\t\treturn Object.keys(this.items);\r\n\t}\r\n\r\n\tset (key, value, bypass = false) {\r\n\t\tlet item;\r\n\r\n\t\tif (bypass || this.#has(key)) {\r\n\t\t\titem = this.items[key];\r\n\t\t\titem.value = value;\r\n\r\n\t\t\tif (this.last !== item) {\r\n\t\t\t\tconst last = this.last,\r\n\t\t\t\t\tnext = item.next,\r\n\t\t\t\t\tprev = item.prev;\r\n\r\n\t\t\t\tif (this.first === item) {\r\n\t\t\t\t\tthis.first = item.next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\titem.next = null;\r\n\t\t\t\titem.prev = this.last;\r\n\t\t\t\tlast.next = item;\r\n\r\n\t\t\t\tif (prev !== null) {\r\n\t\t\t\t\tprev.next = next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (next !== null) {\r\n\t\t\t\t\tnext.prev = prev;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (this.max > 0 && this.size === this.max) {\r\n\t\t\t\tthis.evict(true);\r\n\t\t\t}\r\n\r\n\t\t\titem = this.items[key] = {\r\n\t\t\t\texpiry: this.ttl > 0 ? new Date().getTime() + this.ttl : this.ttl,\r\n\t\t\t\tkey: key,\r\n\t\t\t\tprev: this.last,\r\n\t\t\t\tnext: null,\r\n\t\t\t\tvalue\r\n\t\t\t};\r\n\r\n\t\t\tif (++this.size === 1) {\r\n\t\t\t\tthis.first = item;\r\n\t\t\t} else {\r\n\t\t\t\tthis.last.next = item;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.last = item;\r\n\r\n\t\treturn this;\r\n\t}\r\n}\r\n\r\nexport function lru (max = 1000, ttl = 0) {\r\n\tif (isNaN(max) || max < 0) {\r\n\t\tthrow new TypeError(\"Invalid max value\");\r\n\t}\r\n\r\n\tif (isNaN(ttl) || ttl < 0) {\r\n\t\tthrow new TypeError(\"Invalid ttl value\");\r\n\t}\r\n\r\n\treturn new LRU(max, ttl);\r\n}\r\n"],"names":["g","f","exports","module","define","amd","globalThis","self","lru","this","LRU","constructor","max","ttl","first","items","Object","create","last","size","has","key","clear","delete","item","prev","next","evict","bypass","get","result","expiry","Date","getTime","value","set","keys","isNaN","TypeError","defineProperty"],"mappings":"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"}